name: 'Deploy Gateway Rules'

on:
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    environment: tf-env
    
    env:
      CLOUDFLARE_ACCOUNT_ID: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }}
      CLOUDFLARE_API_TOKEN: ${{ secrets.CLOUDFLARE_API_TOKEN }}
    
    steps:
      - name: ðŸ“‚ Checkout
        uses: actions/checkout@v4
        with:
          ref: main

      - name: ðŸ”§ Install jq
        run: |
          sudo apt-get update
          sudo apt-get install -y jq

      - name: ðŸš€ Deploy Gateway Rules
        run: |
          chmod +x ./manage-gateway.sh
          ./manage-gateway.sh reset
